{"ast":null,"code":"// nightland/src/modules/gameLoop.js\nexport const handleMovePlayer = (state, dispatch, key, showDialog) => {\n  const moveDistance = 40; // Match tileSize or element size (40px as in your styles)\n  const newPosition = {\n    ...state.player.position\n  };\n  switch (key) {\n    case 'ArrowUp':\n      newPosition.y = Math.max(0, newPosition.y - moveDistance); // Prevent going off top\n      break;\n    case 'ArrowDown':\n      newPosition.y = Math.min(15960, newPosition.y + moveDistance); // Prevent going off bottom (16000 - 40)\n      break;\n    case 'ArrowLeft':\n      newPosition.x = Math.max(0, newPosition.x - moveDistance); // Prevent going off left\n      break;\n    case 'ArrowRight':\n      newPosition.x = Math.min(15960, newPosition.x + moveDistance); // Prevent going off right (16000 - 40)\n      break;\n    default:\n      return;\n  }\n  dispatch({\n    type: 'MOVE_PLAYER',\n    payload: {\n      position: newPosition\n    }\n  });\n\n  // Update DOM element position\n  const player = document.querySelector('#player');\n  if (player) {\n    player.style.left = `${newPosition.x}px`;\n    player.style.top = `${newPosition.y}px`;\n    player.style.transform = 'none'; // Remove transform for absolute positioning\n  }\n  showDialog(`Player moved ${key.toLowerCase().replace('arrow', '')}`);\n};\nexport const handleMoveMonster = (state, dispatch, monsterName, key, showDialog) => {\n  const moveDistance = 40; // Match tileSize or element size\n  const monster = state.monsters.find(m => m.name === monsterName);\n  if (!monster) return;\n  const newPosition = {\n    ...monster.position\n  };\n  switch (key) {\n    case 'ArrowUp':\n      newPosition.y = Math.max(0, newPosition.y - moveDistance);\n      break;\n    case 'ArrowDown':\n      newPosition.y = Math.min(15960, newPosition.y + moveDistance);\n      break;\n    case 'ArrowLeft':\n      newPosition.x = Math.max(0, newPosition.x - moveDistance);\n      break;\n    case 'ArrowRight':\n      newPosition.x = Math.min(15960, newPosition.x + moveDistance);\n      break;\n    default:\n      return;\n  }\n  dispatch({\n    type: 'MOVE_MONSTER',\n    payload: {\n      name: monsterName,\n      position: newPosition\n    }\n  });\n\n  // Update DOM element position for the monster (class .monster)\n  const monsterElement = document.querySelector(`.monster[data-name=\"${monsterName}\"]`);\n  if (monsterElement) {\n    monsterElement.style.left = `${newPosition.x}px`;\n    monsterElement.style.top = `${newPosition.y}px`;\n    monsterElement.style.transform = 'none';\n  }\n  showDialog(`Monster ${monsterName} moved ${key.toLowerCase().replace('arrow', '')}`);\n};\nexport const handleMoveGreatPower = (state, dispatch, powerName, key, showDialog) => {\n  const moveDistance = 40; // Match tileSize or element size\n  const power = state.greatPowers.find(p => p.name === powerName);\n  if (!power) return;\n  const newPosition = {\n    ...power.position\n  };\n  switch (key) {\n    case 'ArrowUp':\n      newPosition.y = Math.max(0, newPosition.y - moveDistance);\n      break;\n    case 'ArrowDown':\n      newPosition.y = Math.min(15960, newPosition.y + moveDistance);\n      break;\n    case 'ArrowLeft':\n      newPosition.x = Math.max(0, newPosition.x - moveDistance);\n      break;\n    case 'ArrowRight':\n      newPosition.x = Math.min(15960, newPosition.x + moveDistance);\n      break;\n    default:\n      return;\n  }\n  dispatch({\n    type: 'MOVE_GREAT_POWER',\n    payload: {\n      name: powerName,\n      position: newPosition\n    }\n  });\n\n  // Update DOM element position for the great power (e.g., #watcher)\n  const powerElement = document.querySelector(`#watcher`); // Adjust selector based on your HTML\n  if (powerElement) {\n    powerElement.style.left = `${newPosition.x}px`;\n    powerElement.style.top = `${newPosition.y}px`;\n    powerElement.style.transform = 'none';\n  }\n  showDialog(`Great Power ${powerName} moved ${key.toLowerCase().replace('arrow', '')}`);\n};\nexport const handleMoveRedoubt = (state, dispatch, key, showDialog) => {\n  const moveDistance = 40; // Match tileSize or element size\n  const newPosition = {\n    ...state.redoubt.position\n  };\n  switch (key) {\n    case 'ArrowUp':\n      newPosition.y = Math.max(0, newPosition.y - moveDistance);\n      break;\n    case 'ArrowDown':\n      newPosition.y = Math.min(15960, newPosition.y + moveDistance);\n      break;\n    case 'ArrowLeft':\n      newPosition.x = Math.max(0, newPosition.x - moveDistance);\n      break;\n    case 'ArrowRight':\n      newPosition.x = Math.min(15960, newPosition.x + moveDistance);\n      break;\n    default:\n      return;\n  }\n  dispatch({\n    type: 'MOVE_REDOUBT',\n    payload: {\n      position: newPosition\n    }\n  });\n\n  // Update DOM element position for the redoubt\n  const redoubt = document.querySelector('#redoubt');\n  if (redoubt) {\n    redoubt.style.left = `${newPosition.x}px`;\n    redoubt.style.top = `${newPosition.y}px`;\n    redoubt.style.transform = 'none';\n  }\n  showDialog(`Redoubt moved ${key.toLowerCase().replace('arrow', '')}`);\n};\nexport const handleCombatStep = (state, dispatch, showDialog) => {\n  console.log('Combat step executed');\n  // Add combat logic here if needed (e.g., update HP, turn order, etc.)\n  showDialog('Combat step taken');\n};","map":{"version":3,"names":["handleMovePlayer","state","dispatch","key","showDialog","moveDistance","newPosition","player","position","y","Math","max","min","x","type","payload","document","querySelector","style","left","top","transform","toLowerCase","replace","handleMoveMonster","monsterName","monster","monsters","find","m","name","monsterElement","handleMoveGreatPower","powerName","power","greatPowers","p","powerElement","handleMoveRedoubt","redoubt","handleCombatStep","console","log"],"sources":["/mnt/devplex/Nightland/nightland/src/modules/gameLoop.js"],"sourcesContent":["// nightland/src/modules/gameLoop.js\nexport const handleMovePlayer = (state, dispatch, key, showDialog) => {\n    const moveDistance = 40; // Match tileSize or element size (40px as in your styles)\n    const newPosition = { ...state.player.position };\n\n    switch (key) {\n        case 'ArrowUp':\n            newPosition.y = Math.max(0, newPosition.y - moveDistance); // Prevent going off top\n            break;\n        case 'ArrowDown':\n            newPosition.y = Math.min(15960, newPosition.y + moveDistance); // Prevent going off bottom (16000 - 40)\n            break;\n        case 'ArrowLeft':\n            newPosition.x = Math.max(0, newPosition.x - moveDistance); // Prevent going off left\n            break;\n        case 'ArrowRight':\n            newPosition.x = Math.min(15960, newPosition.x + moveDistance); // Prevent going off right (16000 - 40)\n            break;\n        default:\n            return;\n    }\n\n    dispatch({ type: 'MOVE_PLAYER', payload: { position: newPosition } });\n\n    // Update DOM element position\n    const player = document.querySelector('#player');\n    if (player) {\n        player.style.left = `${newPosition.x}px`;\n        player.style.top = `${newPosition.y}px`;\n        player.style.transform = 'none'; // Remove transform for absolute positioning\n    }\n\n    showDialog(`Player moved ${key.toLowerCase().replace('arrow', '')}`);\n};\n\nexport const handleMoveMonster = (state, dispatch, monsterName, key, showDialog) => {\n    const moveDistance = 40; // Match tileSize or element size\n    const monster = state.monsters.find(m => m.name === monsterName);\n    if (!monster) return;\n\n    const newPosition = { ...monster.position };\n\n    switch (key) {\n        case 'ArrowUp':\n            newPosition.y = Math.max(0, newPosition.y - moveDistance);\n            break;\n        case 'ArrowDown':\n            newPosition.y = Math.min(15960, newPosition.y + moveDistance);\n            break;\n        case 'ArrowLeft':\n            newPosition.x = Math.max(0, newPosition.x - moveDistance);\n            break;\n        case 'ArrowRight':\n            newPosition.x = Math.min(15960, newPosition.x + moveDistance);\n            break;\n        default:\n            return;\n    }\n\n    dispatch({ type: 'MOVE_MONSTER', payload: { name: monsterName, position: newPosition } });\n\n    // Update DOM element position for the monster (class .monster)\n    const monsterElement = document.querySelector(`.monster[data-name=\"${monsterName}\"]`);\n    if (monsterElement) {\n        monsterElement.style.left = `${newPosition.x}px`;\n        monsterElement.style.top = `${newPosition.y}px`;\n        monsterElement.style.transform = 'none';\n    }\n\n    showDialog(`Monster ${monsterName} moved ${key.toLowerCase().replace('arrow', '')}`);\n};\n\nexport const handleMoveGreatPower = (state, dispatch, powerName, key, showDialog) => {\n    const moveDistance = 40; // Match tileSize or element size\n    const power = state.greatPowers.find(p => p.name === powerName);\n    if (!power) return;\n\n    const newPosition = { ...power.position };\n\n    switch (key) {\n        case 'ArrowUp':\n            newPosition.y = Math.max(0, newPosition.y - moveDistance);\n            break;\n        case 'ArrowDown':\n            newPosition.y = Math.min(15960, newPosition.y + moveDistance);\n            break;\n        case 'ArrowLeft':\n            newPosition.x = Math.max(0, newPosition.x - moveDistance);\n            break;\n        case 'ArrowRight':\n            newPosition.x = Math.min(15960, newPosition.x + moveDistance);\n            break;\n        default:\n            return;\n    }\n\n    dispatch({ type: 'MOVE_GREAT_POWER', payload: { name: powerName, position: newPosition } });\n\n    // Update DOM element position for the great power (e.g., #watcher)\n    const powerElement = document.querySelector(`#watcher`); // Adjust selector based on your HTML\n    if (powerElement) {\n        powerElement.style.left = `${newPosition.x}px`;\n        powerElement.style.top = `${newPosition.y}px`;\n        powerElement.style.transform = 'none';\n    }\n\n    showDialog(`Great Power ${powerName} moved ${key.toLowerCase().replace('arrow', '')}`);\n};\n\nexport const handleMoveRedoubt = (state, dispatch, key, showDialog) => {\n    const moveDistance = 40; // Match tileSize or element size\n    const newPosition = { ...state.redoubt.position };\n\n    switch (key) {\n        case 'ArrowUp':\n            newPosition.y = Math.max(0, newPosition.y - moveDistance);\n            break;\n        case 'ArrowDown':\n            newPosition.y = Math.min(15960, newPosition.y + moveDistance);\n            break;\n        case 'ArrowLeft':\n            newPosition.x = Math.max(0, newPosition.x - moveDistance);\n            break;\n        case 'ArrowRight':\n            newPosition.x = Math.min(15960, newPosition.x + moveDistance);\n            break;\n        default:\n            return;\n    }\n\n    dispatch({ type: 'MOVE_REDOUBT', payload: { position: newPosition } });\n\n    // Update DOM element position for the redoubt\n    const redoubt = document.querySelector('#redoubt');\n    if (redoubt) {\n        redoubt.style.left = `${newPosition.x}px`;\n        redoubt.style.top = `${newPosition.y}px`;\n        redoubt.style.transform = 'none';\n    }\n\n    showDialog(`Redoubt moved ${key.toLowerCase().replace('arrow', '')}`);\n};\n\nexport const handleCombatStep = (state, dispatch, showDialog) => {\n    console.log('Combat step executed');\n    // Add combat logic here if needed (e.g., update HP, turn order, etc.)\n    showDialog('Combat step taken');\n};"],"mappings":"AAAA;AACA,OAAO,MAAMA,gBAAgB,GAAGA,CAACC,KAAK,EAAEC,QAAQ,EAAEC,GAAG,EAAEC,UAAU,KAAK;EAClE,MAAMC,YAAY,GAAG,EAAE,CAAC,CAAC;EACzB,MAAMC,WAAW,GAAG;IAAE,GAAGL,KAAK,CAACM,MAAM,CAACC;EAAS,CAAC;EAEhD,QAAQL,GAAG;IACP,KAAK,SAAS;MACVG,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC,CAAC,CAAC;MAC3D;IACJ,KAAK,WAAW;MACZC,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC,CAAC,CAAC;MAC/D;IACJ,KAAK,WAAW;MACZC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC,CAAC,CAAC;MAC3D;IACJ,KAAK,YAAY;MACbC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC,CAAC,CAAC;MAC/D;IACJ;MACI;EACR;EAEAH,QAAQ,CAAC;IAAEY,IAAI,EAAE,aAAa;IAAEC,OAAO,EAAE;MAAEP,QAAQ,EAAEF;IAAY;EAAE,CAAC,CAAC;;EAErE;EACA,MAAMC,MAAM,GAAGS,QAAQ,CAACC,aAAa,CAAC,SAAS,CAAC;EAChD,IAAIV,MAAM,EAAE;IACRA,MAAM,CAACW,KAAK,CAACC,IAAI,GAAG,GAAGb,WAAW,CAACO,CAAC,IAAI;IACxCN,MAAM,CAACW,KAAK,CAACE,GAAG,GAAG,GAAGd,WAAW,CAACG,CAAC,IAAI;IACvCF,MAAM,CAACW,KAAK,CAACG,SAAS,GAAG,MAAM,CAAC,CAAC;EACrC;EAEAjB,UAAU,CAAC,gBAAgBD,GAAG,CAACmB,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,EAAE,CAAC;AACxE,CAAC;AAED,OAAO,MAAMC,iBAAiB,GAAGA,CAACvB,KAAK,EAAEC,QAAQ,EAAEuB,WAAW,EAAEtB,GAAG,EAAEC,UAAU,KAAK;EAChF,MAAMC,YAAY,GAAG,EAAE,CAAC,CAAC;EACzB,MAAMqB,OAAO,GAAGzB,KAAK,CAAC0B,QAAQ,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,KAAKL,WAAW,CAAC;EAChE,IAAI,CAACC,OAAO,EAAE;EAEd,MAAMpB,WAAW,GAAG;IAAE,GAAGoB,OAAO,CAAClB;EAAS,CAAC;EAE3C,QAAQL,GAAG;IACP,KAAK,SAAS;MACVG,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC;MACzD;IACJ,KAAK,WAAW;MACZC,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC;MAC7D;IACJ,KAAK,WAAW;MACZC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC;MACzD;IACJ,KAAK,YAAY;MACbC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC;MAC7D;IACJ;MACI;EACR;EAEAH,QAAQ,CAAC;IAAEY,IAAI,EAAE,cAAc;IAAEC,OAAO,EAAE;MAAEe,IAAI,EAAEL,WAAW;MAAEjB,QAAQ,EAAEF;IAAY;EAAE,CAAC,CAAC;;EAEzF;EACA,MAAMyB,cAAc,GAAGf,QAAQ,CAACC,aAAa,CAAC,uBAAuBQ,WAAW,IAAI,CAAC;EACrF,IAAIM,cAAc,EAAE;IAChBA,cAAc,CAACb,KAAK,CAACC,IAAI,GAAG,GAAGb,WAAW,CAACO,CAAC,IAAI;IAChDkB,cAAc,CAACb,KAAK,CAACE,GAAG,GAAG,GAAGd,WAAW,CAACG,CAAC,IAAI;IAC/CsB,cAAc,CAACb,KAAK,CAACG,SAAS,GAAG,MAAM;EAC3C;EAEAjB,UAAU,CAAC,WAAWqB,WAAW,UAAUtB,GAAG,CAACmB,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,EAAE,CAAC;AACxF,CAAC;AAED,OAAO,MAAMS,oBAAoB,GAAGA,CAAC/B,KAAK,EAAEC,QAAQ,EAAE+B,SAAS,EAAE9B,GAAG,EAAEC,UAAU,KAAK;EACjF,MAAMC,YAAY,GAAG,EAAE,CAAC,CAAC;EACzB,MAAM6B,KAAK,GAAGjC,KAAK,CAACkC,WAAW,CAACP,IAAI,CAACQ,CAAC,IAAIA,CAAC,CAACN,IAAI,KAAKG,SAAS,CAAC;EAC/D,IAAI,CAACC,KAAK,EAAE;EAEZ,MAAM5B,WAAW,GAAG;IAAE,GAAG4B,KAAK,CAAC1B;EAAS,CAAC;EAEzC,QAAQL,GAAG;IACP,KAAK,SAAS;MACVG,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC;MACzD;IACJ,KAAK,WAAW;MACZC,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC;MAC7D;IACJ,KAAK,WAAW;MACZC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC;MACzD;IACJ,KAAK,YAAY;MACbC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC;MAC7D;IACJ;MACI;EACR;EAEAH,QAAQ,CAAC;IAAEY,IAAI,EAAE,kBAAkB;IAAEC,OAAO,EAAE;MAAEe,IAAI,EAAEG,SAAS;MAAEzB,QAAQ,EAAEF;IAAY;EAAE,CAAC,CAAC;;EAE3F;EACA,MAAM+B,YAAY,GAAGrB,QAAQ,CAACC,aAAa,CAAC,UAAU,CAAC,CAAC,CAAC;EACzD,IAAIoB,YAAY,EAAE;IACdA,YAAY,CAACnB,KAAK,CAACC,IAAI,GAAG,GAAGb,WAAW,CAACO,CAAC,IAAI;IAC9CwB,YAAY,CAACnB,KAAK,CAACE,GAAG,GAAG,GAAGd,WAAW,CAACG,CAAC,IAAI;IAC7C4B,YAAY,CAACnB,KAAK,CAACG,SAAS,GAAG,MAAM;EACzC;EAEAjB,UAAU,CAAC,eAAe6B,SAAS,UAAU9B,GAAG,CAACmB,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,EAAE,CAAC;AAC1F,CAAC;AAED,OAAO,MAAMe,iBAAiB,GAAGA,CAACrC,KAAK,EAAEC,QAAQ,EAAEC,GAAG,EAAEC,UAAU,KAAK;EACnE,MAAMC,YAAY,GAAG,EAAE,CAAC,CAAC;EACzB,MAAMC,WAAW,GAAG;IAAE,GAAGL,KAAK,CAACsC,OAAO,CAAC/B;EAAS,CAAC;EAEjD,QAAQL,GAAG;IACP,KAAK,SAAS;MACVG,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC;MACzD;IACJ,KAAK,WAAW;MACZC,WAAW,CAACG,CAAC,GAAGC,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACG,CAAC,GAAGJ,YAAY,CAAC;MAC7D;IACJ,KAAK,WAAW;MACZC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEL,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC;MACzD;IACJ,KAAK,YAAY;MACbC,WAAW,CAACO,CAAC,GAAGH,IAAI,CAACE,GAAG,CAAC,KAAK,EAAEN,WAAW,CAACO,CAAC,GAAGR,YAAY,CAAC;MAC7D;IACJ;MACI;EACR;EAEAH,QAAQ,CAAC;IAAEY,IAAI,EAAE,cAAc;IAAEC,OAAO,EAAE;MAAEP,QAAQ,EAAEF;IAAY;EAAE,CAAC,CAAC;;EAEtE;EACA,MAAMiC,OAAO,GAAGvB,QAAQ,CAACC,aAAa,CAAC,UAAU,CAAC;EAClD,IAAIsB,OAAO,EAAE;IACTA,OAAO,CAACrB,KAAK,CAACC,IAAI,GAAG,GAAGb,WAAW,CAACO,CAAC,IAAI;IACzC0B,OAAO,CAACrB,KAAK,CAACE,GAAG,GAAG,GAAGd,WAAW,CAACG,CAAC,IAAI;IACxC8B,OAAO,CAACrB,KAAK,CAACG,SAAS,GAAG,MAAM;EACpC;EAEAjB,UAAU,CAAC,iBAAiBD,GAAG,CAACmB,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,EAAE,CAAC;AACzE,CAAC;AAED,OAAO,MAAMiB,gBAAgB,GAAGA,CAACvC,KAAK,EAAEC,QAAQ,EAAEE,UAAU,KAAK;EAC7DqC,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC;EACnC;EACAtC,UAAU,CAAC,mBAAmB,CAAC;AACnC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}